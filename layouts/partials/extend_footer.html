<!-- 路径: layouts/partials/extend_footer.html -->

<div id="custom-bg-layer"></div>
<div id="bg-overlay-layer"></div>

<div class="side-ad-slot ad-left"><div class="ad-content">智能备课 · 助力语文</div></div>
<div class="side-ad-slot ad-right"><div class="ad-content">资源建设 · 课题合作</div></div>

<!-- 页脚信息 -->
<div class="footer-custom" style="text-align:center; padding:30px; border-top:1px dashed #ddd; margin-top:50px; font-size:0.9rem; color:#666;">
    <div onclick="loginAdmin()" style="cursor:pointer; margin-bottom:10px;">
        <span style="background:#2c3e50; color:white; padding:2px 8px; border-radius:4px; margin-right:8px;">公众号</span>
        <strong>@浅墨青言</strong> | 友情链接：<a href="#" style="color:#1a5fb4;">我的博客</a>
    </div>
    <div id="realtime-clock" style="color:#1a5fb4; font-weight:700; margin-bottom:10px;">载入时间...</div>
    <div style="opacity:0.6;">本站由 AI 赋能语文教育课题组维护</div>
</div>

<!-- 管理员工具箱 (默认隐藏) -->
<div id="admin-tools">
    <div id="admin-panel" class="admin-modal">
        <h4 style="margin:0 0 15px 0;">🛠 管理员助手</h4>
        
        <p style="font-size:12px; color:#999; margin-bottom:5px;">更换背景预览：</p>
        <div style="display:flex; gap:5px; margin-bottom:15px;">
            <input type="text" id="bg-input" placeholder="输入图片 URL" style="flex:1; padding:5px; border:1px solid #ddd; border-radius:4px; font-size:12px;">
            <button onclick="previewBg()" style="padding:5px 10px; background:#1a5fb4; color:white; border:none; border-radius:4px; cursor:pointer;">预览</button>
        </div>

        <p style="font-size:12px; color:#999; margin-bottom:5px;">生成文章头部 (Markdown)：</p>
        <button onclick="genPostTemplate()" style="width:100%; padding:8px; background:#2c3e50; color:white; border:none; border-radius:4px; cursor:pointer; margin-bottom:10px;">生成写稿模板</button>
        
        <textarea id="admin-output" style="width:100%; height:80px; font-size:11px; padding:5px; border:1px solid #eee; background:#f9f9f9; display:none;"></textarea>
    </div>
    <div class="admin-btn" id="toggle-admin" style="display:none;" onclick="toggleAdminPanel()">⚙️</div>
</div>

<script>
    // 1. 实时时钟
    function updateClock() {
        const now = new Date();
        const options = { year: 'numeric', month: '2-digit', day: '2-digit', hour: '2-digit', minute: '2-digit', second: '2-digit', hour12: false };
        const timeString = new Intl.DateTimeFormat('zh-CN', options).format(now);
        const weekDays = ['星期日', '星期一', '星期二', '星期三', '星期四', '星期五', '星期六'];
        document.getElementById('realtime-clock').innerHTML = `${timeString} ${weekDays[now.getDay()]}`;
    }
    setInterval(updateClock, 1000); updateClock();

    // 2. 管理员逻辑
    function loginAdmin() {
        const pass = prompt("请输入管理口令：");
        if (pass === "admin888") {
            document.getElementById('toggle-admin').style.display = 'flex';
            alert("管理员权限已开启，点击右下角齿轮使用工具。");
        }
    }

    function toggleAdminPanel() {
        const panel = document.getElementById('admin-panel');
        panel.style.display = panel.style.display === 'block' ? 'none' : 'block';
    }

    // 预览并生成配置代码
    function previewBg() {
        const url = document.getElementById('bg-input').value.trim();
        const layer = document.getElementById('custom-bg-layer');
        const output = document.getElementById('admin-output');
        
        if (url) {
            layer.style.backgroundImage = `url('${url}')`;
            document.getElementById('bg-overlay-layer').style.background = 'rgba(253, 252, 248, 0.55)';
            
            output.style.display = 'block';
            output.value = `# 请将此行复制到 hugo.toml 的 [params] 下：\nbackgroundUrl = "${url}"`;
        }
    }

    // 生成写文章模板
    function genPostTemplate() {
        const output = document.getElementById('admin-output');
        const title = prompt("请输入文章标题：") || "新文章";
        const template = `---
title: "${title}"
date: ${new Date().toISOString()}
draft: false
author: "课题组"
description: "在此输入摘要..."
tags: ["AI", "语文"]
---`;
        output.style.display = 'block';
        output.value = template;
        output.select();
        document.execCommand('copy');
        alert("模板已复制到剪贴板，请到 content/posts 下新建 .md 文件粘贴。");
    }

    // 初始化检查本地是否有临时预览背景
    window.onload = () => {
        // 你可以手动在 hugo.toml 设置背景，也可以在这里读取
    };
</script>

<script async src="//busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"></script>