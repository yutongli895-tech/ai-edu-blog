<!-- 
    路径: layouts/partials/extend_footer.html 
    功能: 承载语文主题背景层、侧边文韵装饰框、中式美学页脚及教研管理工具
-->

<!-- 1. 背景层容器 (由 extend_head.html 中的 CSS 变量驱动) -->
<div id="custom-bg-layer"></div>
<div id="bg-overlay-layer"></div>

<!-- 2. 侧边悬浮口号：体现语文学科的人文底蕴与智能创新 -->
<div class="floating-panel pos-l">
    <div class="panel-content">文以载道 · 智驭语言</div>
</div>

<div class="floating-panel pos-r">
    <div class="panel-content">经典传承 · 创新教学</div>
</div>

<!-- 3. 页脚自定义内容区 -->
<div class="footer-custom" style="text-align:center; padding:50px 20px; margin-top:80px; border-top:1px solid #e2e8f0; color:#64748b; font-size:0.9rem;">
    <!-- 身份标识区：课题组与公众号 -->
    <div onclick="loginAdmin()" style="cursor:pointer; margin-bottom:25px; display:flex; justify-content:center; gap:15px; align-items:center; flex-wrap:wrap;">
        <div style="display:flex; align-items:center; gap:8px;">
            <span style="background:var(--theme); color:white; padding:4px 12px; border-radius:6px; font-weight:bold; box-shadow:0 4px 12px rgba(178, 31, 31, 0.3);">AI 语文课题组</span>
            <strong style="color:var(--primary); font-family:'Noto Serif SC', serif;">@语言计算实验室</strong>
        </div>
        <div style="display:flex; align-items:center; gap:8px;">
            <span style="background:#2c3e50; color:white; padding:4px 12px; border-radius:6px; font-weight:bold;">公众号</span>
            <strong style="color:var(--primary);">@浅墨青言</strong>
        </div>
    </div>

    <!-- 实时文韵时钟 -->
    <div id="realtime-clock" style="font-family:'Inter', sans-serif; color:var(--theme); font-weight:700; margin-bottom:15px; letter-spacing:1px;">
        CULTURE_SYSTEM_SYNCING...
    </div>
    
    <!-- 浏览数据统计区 (语文意境化) -->
    <div style="font-size:0.85rem; line-height:2; opacity:0.9;">
        <span id="busuanzi_container_site_uv" style="display:inline; margin-right: 20px;">
            🖋️ 雅鉴人数: <span id="busuanzi_value_site_uv" style="color:var(--theme); font-weight:bold;">--</span>
        </span>
        <span id="busuanzi_container_site_pv" style="display:inline;">
            📜 卷轴翻阅: <span id="busuanzi_value_site_pv" style="color:var(--theme); font-weight:bold;">--</span>
        </span>
        <br/>
        <span style="margin-top: 8px; display: block; letter-spacing: 2px; font-family:'Noto Serif SC', serif;">智启人文新形态 · 墨香共研数字化</span>
    </div>
</div>

<!-- 4. 管理员工具箱 (口令: admin888) -->
<div id="admin-tools">
    <div id="admin-panel" style="display:none; position:fixed; bottom:90px; right:30px; background:white; padding:20px; border-radius:15px; box-shadow:0 10px 40px rgba(0,0,0,0.15); width:280px; border:1px solid #f1f5f9; z-index:999;">
        <h4 style="margin:0 0 15px 0; color:var(--theme); border-bottom:2px solid var(--theme); display:inline-block; font-family:'Noto Serif SC', serif;">📖 语文管理助手</h4>
        
        <!-- 背景更换预览 -->
        <p style="font-size:12px; color:#94a3b8; margin:10px 0 5px 0;">更换宣纸背景预览 (URL):</p>
        <div style="display:flex; gap:5px; margin-bottom:15px;">
            <input type="text" id="bg-input" placeholder="输入背景图 URL..." style="flex:1; padding:6px; border:1px solid #e2e8f0; border-radius:6px; font-size:11px; outline:none;">
            <button onclick="previewBg()" style="padding:6px 12px; background:var(--theme); color:white; border:none; border-radius:6px; cursor:pointer; font-size:11px; font-weight:600;">预览</button>
        </div>

        <!-- 写稿模板 -->
        <p style="font-size:12px; color:#94a3b8; margin-bottom:5px;">教研内容生成：</p>
        <button onclick="genEduTemplate()" style="width:100%; padding:8px; background:var(--primary); color:white; border:none; border-radius:6px; cursor:pointer; font-size:11px; font-weight:600;">生成语文教研模板</button>
        
        <textarea id="admin-output" style="width:100%; height:80px; font-size:10px; padding:5px; border:1px solid #eee; background:#f9f9f9; display:none; margin-top:10px; resize:none; font-family:'Inter', monospace; color:#666;"></textarea>
    </div>
    
    <!-- 悬浮管理按钮 -->
    <div id="toggle-admin" style="display:none; position:fixed; bottom:30px; right:30px; width:46px; height:46px; background:var(--primary); color:white; border-radius:50%; justify-content:center; align-items:center; cursor:pointer; font-size:1.4rem; box-shadow:0 8px 24px rgba(178, 31, 31, 0.2); z-index:1000; transition: transform 0.2s;" onclick="toggleAdminPanel()">⚙️</div>
</div>

<!-- 5. 核心逻辑脚本 -->
<script>
    // --- 5.1 实时文韵时钟 ---
    function updateClock() {
        const now = new Date();
        const timeString = now.toLocaleString('zh-CN', { 
            hour12: false,
            hour: '2-digit',
            minute: '2-digit',
            second: '2-digit'
        });
        const el = document.getElementById('realtime-clock');
        if (el) el.innerHTML = timeString + " [SYSTEM_STABLE]";
    }
    setInterval(updateClock, 1000);
    updateClock();

    // --- 5.2 管理登录逻辑 ---
    function loginAdmin() {
        const key = prompt("请输入语文教研管理密钥：");
        if (key === "admin888") {
            const btn = document.getElementById('toggle-admin');
            if (btn) btn.style.display = 'flex';
            sessionStorage.setItem('edu_admin_active', 'true');
            alert("✅ 语文教研管理权限已解锁");
        } else if (key !== null) {
            alert("❌ 密钥错误，权限验证失败");
        }
    }

    // --- 5.3 面板切换 ---
    function toggleAdminPanel() {
        const panel = document.getElementById('admin-panel');
        if (panel) {
            panel.style.display = (panel.style.display === 'none') ? 'block' : 'none';
        }
    }

    // --- 5.4 背景实时预览 ---
    function previewBg() {
        const url = document.getElementById('bg-input').value.trim();
        if (url) {
            document.documentElement.style.setProperty('--global-bg', `url('${url}')`);
        }
    }

    // --- 5.5 生成写稿模板 ---
    function genEduTemplate() {
        const output = document.getElementById('admin-output');
        const title = prompt("请输入教研文章标题：") || "AI 赋能下的语文教学新形态";
        const template = `---
title: "${title}"
date: ${new Date().toISOString()}
draft: false
author: "课题组"
description: "本文探讨了人工智能在中学语文教学中的深度应用..."
tags: ["AI", "语文教育", "教学创新"]
---

### 1. 教学设计背景
利用大型语言模型辅助进行文本细读...

### 2. 核心实验过程
此处插入 AI 辅助生成的教学设计逻辑。

### 3. 教学反思与总结
...`;

        output.style.display = 'block';
        output.value = template;
        output.select();
        try {
            document.execCommand('copy');
            alert("✓ 语文教研模板已生成并复制到剪贴板");
        } catch (e) {}
    }

    // 状态保持检查
    window.addEventListener('DOMContentLoaded', () => {
        if (sessionStorage.getItem('edu_admin_active') === 'true') {
            const btn = document.getElementById('toggle-admin');
            if (btn) btn.style.display = 'flex';
        }
    });
</script>

<!-- 6. 不蒜子访问统计脚本 -->
<script async src="//busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"></script>